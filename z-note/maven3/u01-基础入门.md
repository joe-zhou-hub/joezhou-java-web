# 1. 概念入门

**概念：** `maven`，意为专家，是Apache下的一个纯java开发的免费开源，跨平台的项目管理工具：
- `maven` 可以对项目进行一键构建，每个命令都会以此执行之前的命令：
    - `clean`：清理，清理target文件夹下的class信息。
    - `compile`：编译，将java文件编译成class文件。
    - `test`：测试，测试代码正确性。
    - `package`：打包，java项目打jar包，web项目打war包
    - `install`：部署，项目自动部署到maven仓库中
- `maven` 擅于集中管理项目依赖，在 `pom.xml` 中以坐标的方式引入[中央仓库](https://mvnrepository.com/)的依赖，自动下载，安全便捷。

# 2. 环境搭建

- 软件下载：
    - 进入到 [maven下载位置](http://maven.apache.org/download.cgi)
    - 点击 `Previous Releases` 中的  `archives` 选择过往版本，如 `3.6.0`。
    - 点击 `binaries` - `apache-maven-3.6.0-bin.zip` 进行下载。
- 目录结构：
    - `bin`: maven相关的可执行程序，如 `mvn.bat` 和 `mvnDebug.bat` 等。
    - `boot`: maven运行需要的类加载器。
    - `conf`: maven运行需要的配置文件，如 `settings.xml` 等。
    - `lib`: maven运行需要的依赖jar包。
- 环境搭建：
    - 使用maven的前提是JDK1.7+环境，且必须正确配置了 `JAVA_HOME`。
    - 新建环境变量 `MAVEN_HOME` 为安装包根路径。
    - 添加环境变量 `path` 为 `%MAVEN_HOME%\bin`。
    - 通过 `mvn -v` 或者 `mvn -version` 命令检查maven是否安装成功。

# 3. 仓库配置

**概念：** 假设本地项目需要 `a.jar`，优先在本地仓库寻找，若有直接用，若无再去远程仓库寻找（假设已搭建），若有下载到本地仓库并使用，若无再去中央仓库寻找，若有下载到远程仓库，再下载到本地仓库使用，若无考虑 `a.jar` 是否收费，或为自行开发的jar资源：
- 仓库分类：
    - 本地仓库：本地某个文件夹，需自行配置。
    - 远程仓库：一般用于多地团队开发，可以内网配置或外网配置。
    - 中央仓库：maven团队维护的仓库，服务于外网，地址为 `http://repo1.maven.org/maven2`。    
- 配置本地仓库：默认在 `C:\Users\Administrator\.m2\repository`：
    - 新建 `D:\coder\java\maven\repos` 目录，位置和取名随意。
    - 打开 `conf/settings.xml`，在 `<settings>` 中配置本地仓库位置。
    - `<localRepository>D:\coder\java\maven\repos</localRepository>`。
- 配置阿里云私服镜像：中央仓库下载速度过慢，可以配置阿里云等其他国内下载镜像： 
    - 打开 `conf/settings.xml`，在 `<mirrors>` 中配置阿里云镜像内容。
- 下载基本插件：CMD进入命令行：
    - `mvn help:system`：加载基本插件，提示 `BUILD SUCCESS` 表示完成。

**配置：** settings.xml
```xml
<!-- 阿里云仓库镜像 -->
<mirror>
    <id>alimaven</id>
    <mirrorOf>central</mirrorOf>
    <name>aliyun maven</name>
    <url>http://maven.aliyun.com/nexus/content/repositories/central/</url>
</mirror>
```

# 4. 整合IDEA

**流程：**
- `File` - `Settings` - `Build, Execution, Deployment` - `Build Tools` - `Maven`。
- 在 `Maven home directory` 栏选择maven的根目录。
- 勾选 `User settings file` 后的 `Override`，然后选择maven的 `settings.xml` 文件。
- 勾选 `Local repository` 后的 `Override`，然后选择maven的正确仓库位置。
- 点击 `OK` 确认修改，重启IDEA，否则不生效。

# 5. maven-jar项目

**概念：** 创建 `com.joezhou.maven-jar` 项目：
- 创建流程：
    - `File` - `New Project` - `Maven` - `Next`。
    - 填写 `GroupId` 横坐标，一般是公司的域名倒置，相当于包名。
    - 填写 `ArtifactId` 纵坐标，一般是项目名。
    - 填写 `Project name` 项目名，默认自动填写纵坐标名称。
    - 填写 `Project location` 项目存放位置，注意IDEA不生成项目名目录。
    - 点击 `Finish`，若提示文件目录不存在，询问是否创建，选择 `OK` 即可。
    - 新项目右下角提示，选择 `Enable Auto-Import` 自动导入maven配置。
- 项目结构：
    - `src/main/java`：源代码文件存放位置。
    - `src/main/resources`：资源文件，属性文件存放位置。
    - `src/test/java`：单元测试文件存放位置。
    - `pom.xml`：maven的核心配置文件。
- 配置文件：pom.xml文件解析
    - `<project>`：配置文件的根标签。
    - `<modelVersion>`：模型版本。
    - `<groupId>`：项目的横坐标。
    - `<artifactId>`：项目的纵坐标。
    - `<version>`：项目的版本，SNAPSHOT是快照版。
- 项目开发：
    - 在 `pom.xml` 中配置jdk的编译版本，默认JDK5。
    - 在 `pom.xml` 中补充 `<dependencies>` 并配置junit4.11依赖。
    - 在 `src/main/java` 中开发 `HelloWorld.java`。
    - 在 `src/test/java` 中开发 `HelloWorldTest.java`。

> 在maven窗口可以快速测试maven命令效果。

**配置：** 在 `pom.xml` 中更改JDK编译版本。
```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <configuration>
                <source>8</source>
                <target>8</target>
            </configuration>
        </plugin>
    </plugins>
</build>
```

**配置：** 在 `pom.xml` 中配置junit依赖。
```xml
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.11</version>
    <scope>test</scope>
</dependency>
```

**源码：** src/main/java/HelloWorld.java

**源码：** src/test/java/HelloWorldTest.java

# 6. maven-war项目

**概念：** 创建 `com.joezhou.maven-war` 项目：
- 创建流程：
    - `File` - `New Project` - `Maven` - `Next`。
    - 填写 `GroupId` 横坐标，一般是公司的域名倒置，相当于包名。
    - 填写 `ArtifactId` 纵坐标，一般是项目名。
    - 填写 `Project name` 项目名，默认自动填写纵坐标名称。
    - 填写 `Project location` 项目存放位置，注意IDEA不生成项目名目录。
    - 点击 `Finish`，若提示文件目录不存在，询问是否创建，选择 `OK` 即可。
    - 新项目右下角提示，选择 `Enable Auto-Import` 自动导入maven配置。
- 项目结构：
    - `src/main/java`：源代码文件存放位置。
    - `src/main/resources`：资源文件，属性文件存放位置。
    - `src/test/java`：单元测试文件存放位置。
    - `pom.xml`：maven的核心配置文件。
- 配置文件：pom.xml文件解析
    - `<project>`：配置文件的根标签。
    - `<modelVersion>`：模型版本。
    - `<groupId>`：项目的横坐标。
    - `<artifactId>`：项目的纵坐标。
    - `<version>`：项目的版本，SNAPSHOT是快照版。
- 项目开发：
    - 在 `pom.xml` 中配置jdk的编译版本，默认JDK5。
    - 在 `src/main/java` 中开发 `HelloWorld.java`。

# 1. Maven创建war包项目

**需求：** 利用Maven创建一个war包项目。

**流程：**
1. 点击 `File` - `New` - `Project...` - `Maven`，如图1-1。
2. 勾选 `Create from archetype`。
3. 选择 `org.apache.maven.archetypes:maven-artchetype-webapp`，点击 `Next`。
4. 填写项目横纵坐标，如图1-2。
5. 检查Maven信息，如图1-3。
    - 检查Maven的安装目录是否正确。
    - 检查 `setting.xml` 文件的位置是否正确。
    - 检查仓库位置是否正确。
6. 指定项目的位置，然后点击 `Finish` 完成web项目的创建，如图1-4。
7. 不要忘了点击Maven的自动导入，选择 `Auto Import`。

![](https://user-gold-cdn.xitu.io/2020/4/21/1719a88b65742697?w=1125&h=723&f=png&s=108168 "图1-1")

![](https://user-gold-cdn.xitu.io/2020/4/21/1719ab42ca2fcc5e?w=971&h=619&f=png&s=13542 "图1-2")

![](https://user-gold-cdn.xitu.io/2020/4/21/1719ab635bf3de62?w=971&h=619&f=png&s=24723 "图1-3")

![](https://user-gold-cdn.xitu.io/2020/4/21/1719ab7419b951fe?w=971&h=619&f=png&s=13154 "图1-4")

# 2. 补齐Maven创建war包项目

**概念：** 通过Maven生成的web项目还缺少几个重要的目录，需要手动添加：
- 补齐java源代码文件夹：`src/main/java`
    - 点击 `main` 文件夹，右键 `new` 一个 `Directory` 并取名为 `java`。
    - 点击 `java` 文件夹，右键 `Mark Directory as` ，选择 `Source Root`。
- 补齐java资源文件夹：`src/main/resources`
    - 点击 `main` 文件夹，右键 `new` 一个 `Directory` 并取名为 `resources`。
    - 点击 `resources` 文件夹，右键 `Mark Directory as` ，选择 `Resources Root`。
- 补齐java测试文件夹：`src/test/java`
    - 点击 `src` 文件夹，右键 `new` 一个 `Directory` 并取名为 `test`。
    - 点击 `test` 文件夹，右键 `new` 一个 `Directory` 并取名为 `java`。
    - 点击 `java` 文件夹，右键 `Mark Directory as` ，选择 `Test Source Root`。

# 3. 完整的war包项目结构

```
项目名
    |_ src：源代码文件夹
        |_ main
            |_ java：存放java源代码
            |_ resources：存放资源文件
            |_ webapp：项目发布文件夹
                |_ WEB-INF
                    |_ web.xml：项目的核心配置文件
                |_ index.jsp：项目的首页
        |_ test：测试文件夹
            |_ java：java测试源代码
    |_ pom.xml：maven的核心配置文件
```

# 4. pom.xml文件解析

标签 | 描述
-|-
`<project>` | 根标签
`<modelVersion>` | 模型版本
`<groupId>` | 项目的横坐标，项目包名
`<artifactId>` | 项目的纵坐标，项目名
`<version>` | 项目的版本，SNAPSHOT是快照版
`<name>` | 项目的名称，可删除
`<url>` | 项目的URL，可删除
`<properties>` | 项目配置根标签
`<project.build.sourceEncoding>` | 项目构建编
`<maven.compiler.source>` | 项目编译的源码版本，修改为1.8
`<maven.compiler.target>` | 项目编译的字节码版本，修改为1.8
`<project.build.sourceEncoding>` | 项目构建编码
`<dependencies>` | 项目依赖集合根标签
`<dependency>` | 项目依赖根标签
`<scope>` | 项目依赖的生效范围

**优化后的pom.xml配置：**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0     
        http://maven.apache.org/xsd/maven-4.0.0.xsd">
  
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.joe</groupId>
    <artifactId>my_maven_war</artifactId>
    <version>1.0-SNAPSHOT</version>
    <packaging>war</packaging>
    <name>test Maven Webapp</name>
    <url>http://www.example.com</url>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
    </properties>

    <dependencies>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.11</version>
            <scope>test</scope>
        </dependency>
    </dependencies>
</project>
```